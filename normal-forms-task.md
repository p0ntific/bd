# Нарушения НФ и нормализация отношений

## 1. Таблица "Книги"

**ТАБЛИЦА:**
Книги (Название*книги, Автор, Страна*проживания*автора, Название*библиотеки)

**НАРУШЕНИЕ НФ:**
3НФ

**ПРИЧИНА:**
Транзитивная зависимость: страна автора зависит от автора, а не от книги

**ПОЯСНЕНИЕ:**
"Страна*проживания*автора" определяется "Автором", а не ключом записи о книге. Получается цепочка: Книга → Автор → Страна. Это транзитивная зависимость и нарушение 3НФ.

**НОРМАЛИЗАЦИЯ:**

- Книги (ID*книги, Название*книги, ID*автора, ID*библиотеки)
- Авторы (ID*автора, Имя*автора, ID_страны)
- Страны (ID*страны, Название*страны)
- Библиотеки (ID*библиотеки, Название*библиотеки)

---

## 2. Таблица "Заказы" (интернет-магазин)

**ТАБЛИЦА:**
Заказы (Номер*заказа, Название*товара, Количество*товара, Имя*клиента, Адрес_клиента)

**НАРУШЕНИЕ НФ:**
1НФ и 2НФ

**ПРИЧИНА:**
В одном заказе несколько товаров; данные клиента зависят не от всего составного ключа

**ПОЯСНЕНИЕ:**

- 1НФ нарушена: один заказ содержит много товаров — появляются повторяющиеся группы/списки в ячейках.
- 2НФ нарушена: при ключе (Номер*заказа, Название*товара) поля "Имя*клиента" и "Адрес*клиента" зависят только от Номер_заказа, а не от всего ключа.

**НОРМАЛИЗАЦИЯ:**

- Заказы (Номер*заказа, ID*клиента, Дата_заказа)
- Состав*заказа (Номер*заказа, ID_товара, Количество)
- Товары (ID*товара, Название*товара, Цена)
- Клиенты (ID*клиента, Имя*клиента, Адрес_клиента)

---

## 3. Таблица "Клиенты"

**ТАБЛИЦА:**
Клиенты (ID*клиента, Имя*клиента, Регион*клиента, Город*клиента, Почтовый_индекс)

**НАРУШЕНИЕ НФ:**
3НФ

**ПРИЧИНА:**
Транзитивные зависимости: и регион, и индекс определяются городом

**ПОЯСНЕНИЕ:**
"Регион*клиента" и "Почтовый*индекс" зависят от "Город_клиента", а не напрямую от ключа клиента. Цепочка: Клиент → Город → Регион/Индекс. Это избыточность и нарушение 3НФ.

**НОРМАЛИЗАЦИЯ:**

- Клиенты (ID*клиента, Имя*клиента, ID_города)
- Города (ID*города, Название*города, Почтовый*индекс, ID*региона)
- Регионы (ID*региона, Название*региона)

---

## 4. Таблица "Заказы" (с НДС)

**ТАБЛИЦА:**
Заказы (Номер*заказа, Цена*без_НДС, НДС)

**НАРУШЕНИЕ НФ:**
3НФ

**ПРИЧИНА:**
"НДС" — производное значение

**ПОЯСНЕНИЕ:**
Если НДС считается как Цена*без*НДС × Ставка_НДС, хранить его не нужно: это дублирование и риск несогласованности при изменении цены или ставки.

**НОРМАЛИЗАЦИЯ:**

- Заказы (Номер*заказа, Цена*без*НДС, Ставка*НДС)

Примечание: сумму НДС лучше считать в запросе:
SELECT Номер*заказа, Цена*без*НДС, (Цена*без*НДС \* Ставка*НДС) AS Сумма_НДС

---

## 5. Таблица "Проект"

**ТАБЛИЦА:**
Проект (ID_проекта, Направление, Куратор)

**НАРУШЕНИЕ НФ:**
3НФ

**ПРИЧИНА:**
Направление определяется куратором, а не проектом

**ПОЯСНЕНИЕ:**
Если у каждого куратора ровно одно направление, то "Направление" зависит от "Куратор". Цепочка: Проект → Куратор → Направление. Это транзитивная зависимость.

**НОРМАЛИЗАЦИЯ:**

- Проекты (ID*проекта, Название*проекта, ID_куратора)
- Кураторы (ID*куратора, ФИО*куратора, ID_направления)
- Направления (ID*направления, Название*направления)

---

### 6. Таблица «Студент, Посещаемый курс, Хобби»

Что нарушено

Логически у студента может быть несколько курсов и несколько хобби.  
Если представлять это одной таблицей вида:

Студент(Студент, Курс, Хобби)

то:

- есть составной ключ (Студент, Курс, Хобби);
- все данные о студенте (ФИО, группа и т.п.) зависят только от Студента,  
  а не от всего ключа.

Это нарушение 2НФ (частичная зависимость неключевых атрибутов от части составного ключа).

Как исправить (нормализация)

Разделить на сущности и связи «многие‑ко‑многим»:

- Студенты(ID*студента, Имя*студента, Группа)
- Курсы(ID*курса, Название*курса)
- Хобби(ID*хобби, Название*хобби)
- Студент*Курс(ID*студента, ID_курса)
- Студент*Хобби(ID*студента, ID_хобби)

---

### 7. Таблица «Сотрудник, Проект, Вид участия»

Что нарушено

Если просто хранить всё в одной таблице:

Участие(Сотрудник, Проект, Вид_участия)

то в таблице смешаны разные сущности (сам сотрудник, сам проект, сам вид участия).  
Атрибуты сотрудника, проекта и вида участия не должны дублироваться здесь, иначе появятся:

- частичные/транзитивные зависимости от составного ключа,
- то есть нарушения 2НФ/3НФ.

Как исправить (нормализация)

Вынести сущности в отдельные таблицы, а «участие» сделать связующей:

- Сотрудники(ID*сотрудника, ФИО*сотрудника, Должность, …)
- Проекты(ID*проекта, Название*проекта, Описание_проекта)
- Виды*участия(ID*вида, Название_вида)
- Участие(  
   ID*сотрудника,  
   ID*проекта,  
   ID*вида,  
   Дата*начала,  
   Дата*окончания,  
   PRIMARY KEY (ID*сотрудника, ID*проекта, ID*вида, Дата_начала)  
  )
